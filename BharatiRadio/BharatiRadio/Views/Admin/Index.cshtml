
@model BharatiRadio.Models.AdminViewModel

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <!-- We'll use the 'Inter' font for a clean dashboard look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Using Phosphor Icons for a modern feel -->
    <script src="@("https://unpkg.com/@phosphor-icons/web")"></script>
    <link href="~/Content/dashboard.css" rel="stylesheet">

</head>
<body>
    @if (TempData["msg"] != null)
    {
        <script>
        alert('@TempData["msg"]');
        </script>
    }
    <!-- --- Sidebar --- -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <!-- This is where your logo would go -->
            <i class="ph-fill ph-radio logo-icon"></i>
            <h2>Admin Panel</h2>
        </div>
        <nav class="sidebar-nav">
            <!--
                data-target attribute links to the ID of the content-section
                This is used by JavaScript to show/hide content
            -->
            <a href="#" class="nav-link active" data-target="dashboard">
                <i class="ph-fill ph-gauge"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-link" data-target="bulletins">
                <i class="ph-fill ph-newspaper"></i>
                <span>Manage Bulletins</span>
            </a>
            <a href="#" class="nav-link" data-target="shows">
                <i class="ph-fill ph-microphone-stage"></i>
                <span>Manage Shows</span>
            </a>
            <a href="#" class="nav-link" data-target="videos">
                <i class="ph-fill ph-video"></i>
                <span>Manage Videos</span>
            </a>
            <a href="#" class="nav-link" data-target="podcasts">
                <i class="ph-fill ph-broadcast"></i>
                <span>Manage Podcasts</span>
            </a>
            <a href="#" class="nav-link" data-target="programs">
                <i class="ph-fill ph-star"></i>
                <span>Special Programs</span>
            </a>
            <a href="#" class="nav-link" data-target="suggestions">
                <i class="ph-fill ph-lightbulb"></i>
                <span>Suggestions</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="#" class="btn btn-secondary" style="width: 100%;">
                <i class="ph-fill ph-sign-out"></i>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- --- Main Content --- -->
    <main class="main-content" id="main-content">
        <header class="header">
            <div class="header-left">
                <button id="menu-toggle" title="Toggle Menu">
                    <i class="ph-fill ph-list"></i>
                </button>
                <h1 id="page-title">Dashboard</h1>
            </div>
            <div class="user-profile">
                <br />
                <span>Welcome, Admin</span>
                <img src="https://placehold.co/40x40/e2e8f0/334155?text=A" alt="Admin user avatar">
            </div>
        </header>

        <div class="content">

            <!-- == Dashboard Content == -->
            <section id="dashboard" class="content-section active">
                <div class="card-grid">
                    <div class="card">
                        <div class="card-icon icon-bulletin">
                            <i class="ph ph-newspaper"></i>
                        </div>
                        <div class="card-info">
                            <h3>@Model.Bulletins.Count()</h3>
                            <p>Total Bulletins</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon icon-shows">
                            <i class="ph ph-microphone-stage"></i>
                        </div>
                        <div class="card-info">
                            <h3>42</h3>
                            <p>Total Shows</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon icon-videos">
                            <i class="ph ph-video"></i>
                        </div>
                        <div class="card-info">
                            <h3>215</h3>
                            <p>Total Videos</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon icon-podcasts">
                            <i class="ph ph-broadcast"></i>
                        </div>
                        <div class="card-info">
                            <h3>76</h3>
                            <p>Total Podcasts</p>
                        </div>
                    </div>

                </div>
                <!-- You could add more charts or widgets here -->
            </section>

            <!-- == Manage Bulletins Content == -->
            <section id="bulletins" class="content-section">
                <div class="toolbar">
                    <div class="toolbar-left">
                        <button class="btn btn-primary" id="createNewBulletinBtn">
                            <i class="ph-fill ph-plus-circle"></i>
                            <span>Create New Bulletin</span>
                        </button>
                    </div>
                    <div class="toolbar-right">
                        <div class="search-bar">
                            <i class="ph ph-magnifying-glass"></i>
                            <input type="text" placeholder="Search bulletins...">
                        </div>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Tag</th>
                                <th>Status</th>
                                <th>Content</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Bulletins)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.title)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.tag)
                                    </td>
                                    <td>
                                        <span class="status status-published">
                                            @Html.DisplayFor(modelItem => item.status)
                                        </span>
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.content)
                                    </td>
                                    <td>
                                        <button class="btn btn-action btn-edit" title="Edit" data-id="@item.Id">
                                            <i class="ph-fill ph-pencil-simple"></i>
                                        </button>
                                        <button class="btn btn-action btn-delete" title="Delete" id="DeleteBulletin">
                                            <i class="ph-fill ph-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </section>

            <!-- == Other Content Sections (Placeholders) == -->
            <section id="shows" class="content-section">
                <h2>Manage Shows</h2>
                <p>CRUD interface for 'Shows' would go here.</p>
            </section>

            <section id="videos" class="content-section">
                <h2>Manage Videos</h2>
                <p>CRUD interface for 'Videos' would go here.</p>
            </section>

            <section id="podcasts" class="content-section">
                <h2>Manage Podcasts</h2>
                <p>CRUD interface for 'Podcasts' would go here.</p>
            </section>

            <section id="programs" class="content-section">
                <h2>Manage Special Programs</h2>
                <p>CRUD interface for 'Special Programs' would go here.</p>
            </section>

            <section id="suggestions" class="content-section">
                <h2>View Suggestions</h2>
                <br />
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Contact No.</th>
                                <th>Subject</th>
                                <th>Suggestion</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Feedbacks)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.email)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.contact_no)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.subject)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.msg)
                                    </td>
                                    <td>
                                        <button class="btn btn-action btn-view-suggestion" title="View" data-id="@item.Id">
                                            <i class="ph-fill ph-pencil-simple"></i>
                                        </button>
                                        <button class="btn btn-action btn-delete" title="Delete" data-id="@item.Id" id="DeleteSuggestion">
                                            <i class="ph-fill ph-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </section>

        </div>
    </main>

    <!-- --- Create/Edit Modal --- -->
    <div class="modal-overlay" id="bulletin-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h2 id="modal-title">Create New Bulletin</h2>
                <button class="modal-close-btn" data-dismiss="modal">
                    <i class="ph-fill ph-x"></i>
                </button>
            </div>
            <form id="bulletin-form" method="post" action="@Url.Action("NewBulletin", "Admin")">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="bulletin-title">Title</label>
                        <input type="text" id="bulletin-title" placeholder="Enter bulletin title" name="title" required>
                        <input type="hidden" name="id" id="bulletin-id" />
                    </div>

                    <div class="form-group">
                        <label for="bulletin-status">Category</label>
                        <select id="bulletin-status" name="status" required>
                            <option value="Draft">Draft</option>
                            <option value="Published">Published</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bulletin-tag">Tag</label>
                        <input type="text" id="bulletin-tag" placeholder="Enter bulletin tag..." name="tag" required>
                    </div>

                    <div class="form-group">
                        <label for="bulletin-content">Content</label>
                        <textarea id="bulletin-content" placeholder="Write your bulletin content here..." name="content"></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary bulletin-btn">Save Bulletin</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal-overlay" id="suggestion-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h2 id="modal-title">Suggestion</h2>
                <button class="modal-close-btn" data-dismiss="modal">
                    <i class="ph-fill ph-x"></i>
                </button>
            </div>
            <form id="suggestion-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="suggestion-subject">Subject</label>
                        <span id="sugg-sub"></span>
                    </div>

                    <div class="form-group">
                        <label for="suggestion-category">Name</label>
                        <input id="sugg-name" readonly />
                    </div>

                    <div class="form-group">
                        <label for="suggestion-email">Email</label>
                        <input id="sugg-email" readonly />
                    </div>

                    <div class="form-group">
                        <label for="suggestion-contact">Contact No.</label>
                        <input id="sugg-contact" readonly />
                    </div>

                    <div class="form-group">
                        <label for="suggestion-location">Location</label>
                        <input id="sugg-loction" readonly />
                    </div>

                    <div class="form-group">
                        <label for="suggestion-msg">Message</label>
                        <textarea id="sugg-msg" readonly></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Delete</button>
                </div>
            </form>
        </div>
    </div>


    <!-- --- Delete Confirmation Modal --- -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal-box" style="max-width: 450px;">
            <div class="modal-header">
                <h2 id="modal-title">Confirm Deletion</h2>
                <button class="modal-close-btn" data-dismiss="modal">
                    <i class="ph-fill ph-x"></i>
                </button>
            </div>
            <p style="margin-bottom: 1.5rem; color: #475569;">Are you sure you want to delete this item? This action cannot be undone.</p>
            <div class="modal-footer" style="border-top: none; padding-top: 0;">
                <form method="post" action="@Url.Action("DeleteBulletin", "Admin")" id="delete-confirm-box">
                    <input type="hidden" name="Id"/>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-delete" style="background-color: #e11d48; color: white;">
                        <i class="ph-fill ph-trash"></i>
                        <span>Yes, Delete</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const pageTitle = document.getElementById('page-title');

            // --- Navigation Handling ---
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');

                    // Update active link
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');

                    // Update content section
                    contentSections.forEach(section => {
                        if (section.id === targetId) {
                            section.classList.add('active');
                        } else {
                            section.classList.remove('active');
                        }
                    });

                    // Update page title
                    pageTitle.textContent = link.querySelector('span').textContent;
                });
            });

            // --- Modal Handling ---
            const bulletinModal = document.getElementById('bulletin-modal');
            const deleteModal = document.getElementById('delete-modal');
            const createBtn = document.getElementById('createNewBulletinBtn');
            const editBtns = document.querySelectorAll('.btn-edit');
            const deleteBtns = document.querySelectorAll('.btn-delete');
            const dismissBtns = document.querySelectorAll('[data-dismiss="modal"]');

            const openModal = (modal) => {
                if (modal) {
                    modal.classList.add('active');
                }
            };

            const closeModal = (modal) => {
                if (modal) {
                    modal.classList.remove('active');
                }
            };

            // Open "Create" modal
            if (createBtn) {
                createBtn.addEventListener('click', () => {
                    document.getElementById('modal-title').textContent = 'Create New Bulletin';
                    document.getElementById('bulletin-form').reset(); // Clear form
                    document.getElementById('bulletin-form').action = "@Url.Action("NewBulletin", "Admin")";
                    openModal(bulletinModal);
                });
            }

            // Open "Edit" modal
            editBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('modal-title').textContent = 'Edit Bulletin';


                    const id = btn.getAttribute('data-id');

                    fetch(`/Admin/ViewBulletin?id=${encodeURIComponent(id)}`)
                        .then(response => {
                            if (!response.ok) throw new Error('Network error');
                            return response.json();
                        })
                        .then(res => {
                            if (!res || res.success === false) {
                                alert(res?.message || 'Error loading suggestion');
                                return;
                            }

                            // Fill modal fields
                            document.getElementById('bulletin-id').value = res.id || '';
                            document.getElementById('bulletin-title').value = res.title || '';
                            document.getElementById('bulletin-status').value = res.status || '';
                            document.getElementById('bulletin-tag').value = res.tag || '';
                            document.getElementById('bulletin-content').textContent = res.content || '';
                            document.getElementById('bulletin-form').action = "@Url.Action("EditBulletin", "Admin")";

                            // 👌 Works now because openModal is in scope!
                            openModal(bulletinModal);
                        })
                        .catch(err => {
                            console.error(err);
                            alert('Something went wrong');
                        });

                });
            });

            // Open "Delete" modal
            deleteBtns.forEach(btn => {
                btn.addEventListener('click', () => {

                    document.getElementById('delete-confirm-box').action = '/Admin/' + deleteBtns.targetId;

                    openModal(deleteModal);
                });
            });

            // Close modals
            dismissBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    closeModal(btn.closest('.modal-overlay'));
                });
            });

            // Close modal on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        closeModal(overlay);
                    }
                });
            });

            // Handle form submission
            document.getElementById('bulletin-form').addEventListener('submit', (e) => {
                // In a real app, you would send this data to a server
                console.log('Form submitted');
                // You could add a success message here
            });

            // --- Mobile Menu Toggle ---
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');

            if (menuToggle) {
                // This is a simple implementation for mobile.
                // A better one would toggle a class.
                console.warn('Mobile menu toggle logic not fully implemented in this static demo.');
                // Example of how it *would* work:
                // menuToggle.addEventListener('click', () => {
                //    sidebar.classList.toggle('is-open');
                //    mainContent.classList.toggle('sidebar-open');
                // });
            }

        });

        document.addEventListener('DOMContentLoaded', () => {

            const bulletinModal = document.getElementById('bulletin-modal');
            const deleteModal = document.getElementById('delete-modal');
            const dismissBtns = document.querySelectorAll('[data-dismiss="modal"]');

            const openModal = (modal) => {
                if (modal) modal.classList.add('active');
            };

            const closeModal = (modal) => {
                if (modal) modal.classList.remove('active');
            };

            // 🔹 Suggestion Modal Logic (add this here)
            const suggestionModal = document.getElementById('suggestion-modal');
            const viewSuggestionButtons = document.querySelectorAll('.btn-view-suggestion');

            viewSuggestionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-id');

                    fetch(`/Admin/ViewSuggestion?id=${encodeURIComponent(id)}`)
                        .then(response => {
                            if (!response.ok) throw new Error('Network error');
                            return response.json();
                        })
                        .then(res => {
                            if (!res || res.success === false) {
                                alert(res?.message || 'Error loading suggestion');
                                return;
                            }

                            // Fill modal fields
                            document.getElementById('sugg-sub').textContent = res.subject || '';
                            document.getElementById('sugg-name').value = res.name || '';
                            document.getElementById('sugg-email').value = res.email || '';
                            document.getElementById('sugg-contact').value = res.contactNo || '';
                            document.getElementById('sugg-loction').value = res.location || '';
                            document.getElementById('sugg-msg').value = res.msg || '';


                            // 👌 Works now because openModal is in scope!
                            openModal(suggestionModal);
                        })
                        .catch(err => {
                            console.error(err);
                            alert('Something went wrong');
                        });
                });
            });

            // Close modal on Cancel/X click
            dismissBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    closeModal(btn.closest('.modal-overlay'));
                });
            });

            // Click outside to close
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) closeModal(overlay);
                });
            });

        });



    </script>
</body>
</html>